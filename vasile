#!/usr/bin/env bash
# Say Hello to Vasile, a script to build Kogaion Linux packages && ISO images using a clean squashfs + overlayfs chroot
# Using predefined targets : kernel.target , xlibs.target , x11.target , sound.target , artwork.target
# Main author : Ghiunhan Mamut (aka V3n3RiX) @ RogentOS Development Group
# Dependencies : kernel built with squashfs +  overlayfs support
#

# generic variables
export local releasename="kogaion"
export local releasetarget="desktop"
export local releaseversion="3"

# arch independent build variables

export local rodir="rodir"
export local rwdir="rwdir"
export local workdir="workdir" # only needed for overlayfs on kernel greather than 3.18
export local overlaydir="overlaydir"
export local chrootuser="root"
export local chroottarget="${@:2}"
export local chrootbuildtarget="emerge -kav "$chroottarget""
export local chrootmainoverlay="layman -f -a "$releasename" -o https://gitlab.com/"$releasename"/"$releasename"-main/raw/master/overlay.xml"
export local chrootaddonoverlay="layman -f -a "$releasename"-"$releasetarget" -o https://gitlab.com/"$releasename"/"$releasename"-"$releasetarget"/raw/master/overlay.xml"
export local chrootbuildgit="cd /opt && git clone https://gitlab.com/"$releasename"/"$releasename"-build.git"
export local chrootportageconfig="ln -sf /opt/"$releasename"-build/conf/intel/portage /etc/portage"
export local chrootenvupdate="/usr/sbin/env-update && . /etc/profile"
export local chrootprofile="eselect profile set 1"

# arch independent iso variables

export local kernelver="3.14.0-"$releasename""

# x64 specific build variables

export local chrootx64=""$releasename"_"$releaseversion"_core_x64.squashfs"
export local chrootx64md5=""$chrootx64".md5"
export local chrootmakeconfx64="ln -sf /opt/"$releasename"-build/conf/intel/portage/make.conf.amd64 /etc/portage/make.conf"

# x86 specific build variables

export local chrootx86=""$releasename"_"$releaseversion"_core_x86.squashfs"
export local chrootx86md5=""$chrootx86".md5"
export local chrootmakeconfx86="ln -sf /opt/"$releasename"-build/conf/intel/portage/make.conf.x86 /etc/portage/make.conf"


source /usr/lib/vasile/libvasile

case $1 in
	--build64)		source /usr/share/vasile/build64
					;;
	--build32)		source /usr/share/vasile/build32
					;;
	--iso64)		source /usr/share/vasile/iso64
					;;
	--iso32)		source /usr/share/vasile/iso32
					;;
	--help)			echo -e ""
					echo -e "Usage: vasile [options]"
					echo -e ""
					echo -e "Options:"
					echo -e "--build64 : build package/target in a clean x64 squashed core"
					echo -e "--build32 : build package/target in a clean x86 squashed core"
					echo -e "--iso64 : build x64 iso based on clean squashed core + targets"
					echo -e "--iso32 : build x86 iso based on clean squashed core + targets"
					echo -e "--help : display this help and exit"
					echo -e ""
					;;
	*)				echo -e "error: no operation specified, use --help for help"
					;;
esac

exit 0
